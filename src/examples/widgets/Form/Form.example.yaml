# Missing schema / stringSchema
# Target: verify behaviour when neither `schema` nor `stringSchema` are provided.
# Expected behavior: the form surface cannot be rendered and an error state is produced
# explaining that a schema is required to build the fields.
kind: Form
apiVersion: widgets.templates.krateo.io/v1beta1
metadata:
  name: example-form-missing-schema
  namespace: krateo-system
spec:
  widgetData:
    submitActionId: submit-minimal
    actions:
      rest:
        - id: submit-minimal
          type: rest
          resourceRefId: resource-ref-1
          headers: []
  resourcesRefs:
    items:
      - id: resource-ref-1
        apiVersion: composition.krateo.io/v1
        name: dummy-submit
        namespace: krateo-system
        resource: dummy
        verb: POST
---
# Basic string fields (required)
# Target: validate simple string inputs and required field enforcement.
# Expected behavior: form exposes text inputs for "name" and "image"; submission blocked until required fields are filled.
kind: Form
apiVersion: widgets.templates.krateo.io/v1beta1
metadata:
  name: example-form-basic-strings
  namespace: krateo-system
spec:
  widgetData:
    fieldDescription: tooltip
    submitActionId: submit-basic
    stringSchema: |
      {
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "title": "Application Name",
            "description": "The name of your app"
          },
          "image": {
            "type": "string",
            "title": "Container Image",
            "description": "Full image path (e.g., ghcr.io/org/image:tag)"
          }
        },
        "required": ["name"]
      }
    actions:
      rest:
        - id: submit-basic
          type: rest
          resourceRefId: resource-ref-1
          headers: []
  resourcesRefs:
    items:
      - id: resource-ref-1
        apiVersion: composition.krateo.io/v1
        name: submit-basic
        namespace: krateo-system
        resource: fireworksapps
        verb: POST
---
# String field with enum (4 values or less) (renders as radio group)
# Target: ensure enum with few options renders compact controls (radios).
# Expected behavior: a small set of choices is rendered as radio buttons and is selectable.
kind: Form
apiVersion: widgets.templates.krateo.io/v1beta1
metadata:
  name: example-form-enum-small
  namespace: krateo-system
spec:
  widgetData:
    submitActionId: submit-enum
    stringSchema: |
      {
        "type": "object",
        "properties": {
          "strategy": {
            "type": "string",
            "title": "Strategy",
            "enum": ["rolling", "recreate", "blue-green"],
            "description": "Deployment strategy"
          }
        }
      }
    actions:
      rest:
        - id: submit-enum
          type: rest
          resourceRefId: resource-ref-1
          headers: []
  resourcesRefs:
    items:
      - id: resource-ref-1
        apiVersion: composition.krateo.io/v1
        name: submit-enum
        namespace: krateo-system
        resource: fireworksapps
        verb: POST
---
# String field with enum (more than 4 values) (multi-option select)
# Target: verify that string fields with multiple enum options are rendered as dropdown selectors.
# Expected behavior: the form displays a select input with exactly three or more available options;
# selecting one updates the underlying field value.
kind: Form
apiVersion: widgets.templates.krateo.io/v1beta1
metadata:
  name: example-form-string-enum
  namespace: krateo-system
spec:
  widgetData:
    submitActionId: submit-string-enum
    stringSchema: |
      {
        "type": "object",
        "properties": {
          "region": {
            "type": "string",
            "title": "Region",
            "enum": ["us-east-1", "eu-central-1", "ap-south-1", "sa-east-1", "eu-east-1"]
          }
        },
        "required": ["region"]
      }
    actions:
      rest:
        - id: submit-string-enum
          type: rest
          resourceRefId: resource-string-enum
          headers: []
  resourcesRefs:
    items:
      - id: resource-string-enum
        apiVersion: composition.krateo.io/v1
        name: resource-string-enum
        namespace: krateo-system
        resource: fireworksapps
        verb: POST
---
# Boolean field default value
# Target: ensure boolean fields initialize correctly and render as toggles.
# Expected behavior: "enableMetrics" shows a switch, defaulting to the provided boolean.
kind: Form
apiVersion: widgets.templates.krateo.io/v1beta1
metadata:
  name: example-form-boolean
  namespace: krateo-system
spec:
  widgetData:
    submitActionId: submit-boolean
    stringSchema: |
      {
        "type": "object",
        "properties": {
          "enableMetrics": {
            "type": "boolean",
            "title": "Enable Metrics",
            "default": true
          }
        }
      }
    actions:
      rest:
        - id: submit-boolean
          type: rest
          resourceRefId: resource-ref-1
          headers: []
  resourcesRefs:
    items:
      - id: resource-ref-1
        apiVersion: composition.krateo.io/v1
        name: submit-boolean
        namespace: krateo-system
        resource: fireworksapps
        verb: POST
---
# Integer field (basic number input)
# Target: validate integer-type fields that are rendered as numeric input controls (not sliders).
# Expected behavior: renders an input box restricted to numeric characters; no slider or range widget.
kind: Form
apiVersion: widgets.templates.krateo.io/v1beta1
metadata:
  name: example-form-integer-basic
  namespace: krateo-system
spec:
  widgetData:
    submitActionId: submit-integer-basic
    stringSchema: |
      {
        "type": "object",
        "properties": {
          "replicas": {
            "type": "integer",
            "title": "Number of Replicas",
            "default": 3
          }
        },
        "required": ["replicas"]
      }
    actions:
      rest:
        - id: submit-integer-basic
          type: rest
          resourceRefId: resource-integer-basic
          headers: []
  resourcesRefs:
    items:
      - id: resource-integer-basic
        apiVersion: composition.krateo.io/v1
        name: resource-integer-basic
        namespace: krateo-system
        resource: fireworksapps
        verb: POST

---
# Integer field with small range (renders slider)
# Target: confirm integer fields with small bounded ranges become slider controls.
# Expected behavior: "replicas" shows a slider when (max - min) < 100; otherwise numeric input.
kind: Form
apiVersion: widgets.templates.krateo.io/v1beta1
metadata:
  name: example-form-integer-slider
  namespace: krateo-system
spec:
  widgetData:
    submitActionId: submit-integer
    stringSchema: |
      {
        "type": "object",
        "properties": {
          "replicas": {
            "type": "integer",
            "title": "Number of Replicas",
            "minimum": 1,
            "maximum": 10,
            "default": 1
          }
        }
      }
    actions:
      rest:
        - id: submit-integer
          type: rest
          resourceRefId: resource-ref-1
          headers: []
  resourcesRefs:
    items:
      - id: resource-ref-1
        apiVersion: composition.krateo.io/v1
        name: submit-integer
        namespace: krateo-system
        resource: fireworksapps
        verb: POST
---
# Array of strings (editable list)
# Target: validate list-of-strings fields (tags, labels) are editable as an array editor.
# Expected behavior: field accepts multiple string entries and serializes them to array.
kind: Form
apiVersion: widgets.templates.krateo.io/v1beta1
metadata:
  name: example-form-array-strings
  namespace: krateo-system
spec:
  widgetData:
    submitActionId: submit-tags
    stringSchema: |
      {
        "type": "object",
        "properties": {
          "tags": {
            "type": "array",
            "title": "Tags",
            "items": { "type": "string" }
          }
        }
      }
    actions:
      rest:
        - id: submit-tags
          type: rest
          resourceRefId: resource-ref-1
          headers: []
  resourcesRefs:
    items:
      - id: resource-ref-1
        apiVersion: composition.krateo.io/v1
        name: submit-tags
        namespace: krateo-system
        resource: fireworksapps
        verb: POST
---
# Array of strings (with enum)
# Target: validate list-of-strings fields (tags, labels) with options specified as enum.
# Expected behavior: a set of options is displayed, multiple selection is enabled and values are serialized into an array.
kind: Form
apiVersion: widgets.templates.krateo.io/v1beta1
metadata:
  name: example-form-array-strings-enum
  namespace: krateo-system
spec:
  widgetData:
    submitActionId: submit-tags
    stringSchema: |
      {
        "type": "object",
        "properties": {
          "tags": {
            "type": "array",
            "title": "Tags",
            "items": {
              "type": "string",
              "enum": ["portal", "composable", "krateo"]
            },
            "default": ["krateo"]
          }
        }
      }
    actions:
      rest:
        - id: submit-tags
          type: rest
          resourceRefId: resource-ref-1
          headers: []
  resourcesRefs:
    items:
      - id: resource-ref-1
        apiVersion: composition.krateo.io/v1
        name: submit-tags
        namespace: krateo-system
        resource: fireworksapps
        verb: POST
---
# Array of objects (object list editor)
# Target: validate object-list fields that expose sub-fields for each array item.
# Expected behavior: editor allows adding/removing objects with configured display field and nested inputs.
kind: Form
apiVersion: widgets.templates.krateo.io/v1beta1
metadata:
  name: example-form-array-object
  namespace: krateo-system
spec:
  widgetData:
    submitActionId: submit-objects
    stringSchema: |
      {
        "type": "object",
        "properties": {
          "env": {
            "type": "array",
            "title": "Environment Variables",
            "items": {
              "type": "object",
              "properties": {
                "name": { "type": "string", "title": "Key" },
                "value": { "type": "string", "title": "Value" }
              },
              "required": ["name","value"]
            }
          }
        }
      }
    objectFields:
      - path: env
        displayField: name
    actions:
      rest:
        - id: submit-objects
          type: rest
          resourceRefId: resource-ref-1
          headers: []
  resourcesRefs:
    items:
      - id: resource-ref-1
        apiVersion: composition.krateo.io/v1
        name: submit-objects
        namespace: krateo-system
        resource: fireworksapps
        verb: POST
---
# Complex mixed schema (strings, enums, boolean, arrays, integers, defaults)
# Target: full integration smoke-test: multiple field types, defaults and optional fields.
# Expected behavior: form renders a combination of controls, initializes defaults, and exposes optional-field toggle if present.
kind: Form
apiVersion: widgets.templates.krateo.io/v1beta1
metadata:
  name: example-form-complex-mix
  namespace: krateo-system
spec:
  widgetData:
    submitActionId: submit-complex
    stringSchema: |
      {
        "type": "object",
        "properties": {
          "name": { "type": "string", "title": "Name" },
          "image": { "type": "string", "title": "Image" },
          "strategy": { "type": "string", "title": "Strategy", "enum": ["rolling","recreate","blue-green"] },
          "enableMetrics": { "type": "boolean", "title": "Enable Metrics", "default": false },
          "replicas": { "type": "integer", "title": "Replicas", "minimum": 1, "maximum": 200, "default": 3 },
          "tags": { "type": "array", "title": "Tags", "items": { "type": "string" } },
          "env": {
            "type": "array",
            "title": "Environment Variables",
            "items": {
              "type": "object",
              "properties": {
                "name": { "type": "string" },
                "value": { "type": "string" }
              }
            }
          }
        },
        "required": ["name","image"]
      }
    autocomplete:
      - name: strategy
    objectFields:
      - path: env
        displayField: name
    actions:
      rest:
        - id: submit-complex
          type: rest
          resourceRefId: resource-ref-1
          headers: []
  resourcesRefs:
    items:
      - id: resource-ref-1
        apiVersion: composition.krateo.io/v1
        name: submit-complex
        namespace: krateo-system
        resource: fireworksapps
        verb: POST
      - id: getStrategies
        apiVersion: composition.krateo.io/v1
        name: getStrategies
        namespace: krateo-system
        resource: restactions
        verb: GET
---
# Complex mixed schema with initial values set
# Target: full integration test to check if initial values are correctly set.
# Expected behavior: form renders a combination of types with initial values.
kind: Form
apiVersion: widgets.templates.krateo.io/v1beta1
metadata:
  name: example-form-complex-initial-values
  namespace: krateo-system
spec:
  widgetData:
    submitActionId: submit-complex
    stringSchema: |
      {
        "type": "object",
        "properties": {
          "name": { "type": "string", "title": "Name" },
          "image": { "type": "string", "title": "Image" },
          "strategy": { "type": "string", "title": "Strategy", "enum": ["rolling","recreate","blue-green"] },
          "secondStrategy": {
            "type": "string",
            "title": "Second strategy",
            "enum": ["rolling", "recreate", "blue-green"],
            "description": "Second deployment strategy"
          },
          "region": {
            "type": "string",
            "title": "Region",
            "enum": ["us-east-1", "eu-central-1", "ap-south-1", "sa-east-1", "eu-east-1"]
          },
          "enableMetrics": { "type": "boolean", "title": "Enable Metrics", "default": false },
          "replicas": { "type": "integer", "title": "Replicas", "minimum": 1, "maximum": 200, "default": 3 },
          "tags": { "type": "array", "title": "Tags", "items": { "type": "string" } },
          "env": {
            "type": "array",
            "title": "Environment Variables",
            "items": {
              "type": "object",
              "properties": {
                "name": { "type": "string" },
                "value": { "type": "string" }
              }
            }
          }
        },
        "required": ["name","image"]
      }
    initialValues:
      name: ciao
      image: v1
      strategy: rolling
      enableMetrics: true
      replicas: 5
      tags: ['krateo']
      env:
        - name: default
          value: def val
      secondStrategy: recreate
      region: eu-central-1
    autocomplete:
      - name: strategy
    objectFields:
      - path: env
        displayField: name
    actions:
      rest:
        - id: submit-complex
          type: rest
          resourceRefId: resource-ref-1
          headers: []
  resourcesRefs:
    items:
      - id: resource-ref-1
        apiVersion: composition.krateo.io/v1
        name: submit-complex
        namespace: krateo-system
        resource: fireworksapps
        verb: POST
      - id: getStrategies
        apiVersion: composition.krateo.io/v1
        name: getStrategies
        namespace: krateo-system
        resource: restactions
        verb: GET
---
# Schema object (alphabetically ordered fields)
# Target: validate rendering from a raw JSON object (`schema` instead of `stringSchema`).
# Expected behavior: field order will be alphabetically ordered.
# This case contrasts with `stringSchema`, which preserves field order as declared in the serialized string.
kind: Form
apiVersion: widgets.templates.krateo.io/v1beta1
metadata:
  name: example-form-ordered-schema
  namespace: krateo-system
spec:
  widgetData:
    submitActionId: submit-ordered
    schema:
      type: object
      properties:
        replicas:
          type: integer
          title: Number of Replicas
          minimum: 1
          maximum: 10
          default: 2
        enableMetrics:
          type: boolean
          title: Enable Metrics
          default: true
        image:
          type: string
          title: Container Image
        name:
          type: string
          title: Application Name
      required:
        - name
        - image
    actions:
      rest:
        - id: submit-ordered
          type: rest
          resourceRefId: resource-ref-1
          headers: []
  resourcesRefs:
    items:
      - id: resource-ref-1
        apiVersion: composition.krateo.io/v1
        name: submit-ordered
        namespace: krateo-system
        resource: fireworksapps
        verb: POST
---
# Form displayed inside Drawer (triggered by Button)
# Target: validate integration of a Form inside a Drawer opened through a Button action.
# Expected behavior: clicking the button opens a Drawer containing the Form; the Form renders correctly, with the submit button and required validations available within the Drawer context.
kind: Button
apiVersion: widgets.templates.krateo.io/v1beta1
metadata:
  name: example-form-button-open-drawer
  namespace: krateo-system
spec:
  widgetData:
    label: Open Drawer with Form
    type: primary
    clickActionId: open-drawer-form
    actions:
      openDrawer:
        - id: open-drawer-form
          type: openDrawer
          resourceRefId: example-form-complex-mix
          size: large
          title: Drawer Form Example
  resourcesRefs:
    items:
      - id: example-form-complex-mix
        apiVersion: widgets.templates.krateo.io/v1beta1
        name: example-form-complex-mix
        namespace: krateo-system
        resource: forms
        verb: GET
---
# Autocomplete field (static values)
# Target: validate autocomplete fields that display a list of static values
# Expected behavior: a 'Start typing...' message is displayed on a select
# and typing triggers the displaying of values
kind: Form
apiVersion: widgets.templates.krateo.io/v1beta1
metadata:
  name: example-form-autocomplete-static
  namespace: krateo-system
spec:
  widgetData:
    autocomplete:
      - name: strategy
    submitActionId: submit-autocomplete-static
    stringSchema: |
      {
        "type": "object",
        "properties": {
          "strategy": { "type": "string", "title": "Strategy", "enum": ["rolling","recreate","blue-green"] }
        },
        "required": ["strategy"]
      }
    actions:
      rest:
        - id: submit-autocomplete-static
          type: rest
          resourceRefId: resource-ref-1
          headers: []
  resourcesRefs:
    items:
      - id: resource-ref-1
        apiVersion: composition.krateo.io/v1
        name: submit-autocomplete-static
        namespace: krateo-system
        resource: fireworksapps
        verb: POST
---
# Autocomplete field (values retrieved from RESTAction)
# Target: validate autocomplete fields that display a list of static values
# Expected behavior: a 'Start typing...' message is displayed on a select
# and typing triggers a call to a RESTACtion that retrieves the values
kind: Form
apiVersion: widgets.templates.krateo.io/v1beta1
metadata:
  name: example-form-autocomplete-restaction
  namespace: krateo-system
spec:
  widgetData:
    autocomplete:
      - name: pod
        resourceRefId: get-pods-for-autocomplete
    submitActionId: submit-autocomplete
    stringSchema: |
      {
        "type": "object",
        "properties": {
          "pod": { "type": "string", "title": "Pod name" }
        },
        "required": ["pod"]
      }
    actions:
      rest:
        - id: submit-autocomplete
          type: rest
          resourceRefId: resource-ref-1
          headers: []
  resourcesRefs:
    items:
      - id: resource-ref-1
        apiVersion: composition.krateo.io/v1
        name: submit-autocomplete
        namespace: krateo-system
        resource: fireworksapps
        verb: POST
      - id: get-pods-for-autocomplete
        apiVersion: templates.krateo.io/v1
        name: get-pods-for-autocomplete
        namespace: krateo-system
        resource: restactions
        verb: GET
---
apiVersion: templates.krateo.io/v1
kind: RESTAction
metadata:
  name: get-pods-for-autocomplete
  namespace: krateo-system
spec:
  api:
  - name: pods
    path: "/api/v1/pods"
  filter: >
    .pods.items | map(
      {
        "label": .metadata.name,
        "value": .metadata.name
      }
    )
---
# Autocomplete field (values retrieved from RESTAction with extra parameter)
# Target: validate autocomplete fields that display a list of static values
# Expected behavior: a 'Start typing...' message is displayed on a select
# and typing triggers a call to a RESTACtion that calls an external API with an additional
# query parameter and retrieves the values
kind: Form
apiVersion: widgets.templates.krateo.io/v1beta1
metadata:
  name: example-form-autocomplete-restaction-parameter
  namespace: krateo-system
spec:
  widgetData:
    autocomplete:
      - name: users
        extra:
          key: name_like
        resourceRefId: get-users-for-autocomplete
    submitActionId: submit-autocomplete
    stringSchema: |
      {
        "type": "object",
        "properties": {
          "users": { "type": "string", "title": "Users" }
        },
        "required": ["users"]
      }
    actions:
      rest:
        - id: submit-autocomplete
          type: rest
          resourceRefId: resource-ref-1
          headers: []
  resourcesRefs:
    items:
      - id: resource-ref-1
        apiVersion: composition.krateo.io/v1
        name: submit-autocomplete
        namespace: krateo-system
        resource: fireworksapps
        verb: POST
      - id: get-users-for-autocomplete
        apiVersion: templates.krateo.io/v1
        name: get-users-for-autocomplete
        namespace: krateo-system
        resource: restactions
        verb: GET
---
apiVersion: templates.krateo.io/v1
kind: RESTAction
metadata:
  name: get-users-for-autocomplete
  namespace: krateo-system
spec:
  api:
  - name: users
    path: "/users"
    endpointRef:
      name: jsonplaceholder-endpoint
      namespace: krateo-system
  filter: >
    .users | map(
      {
        "label": .name,
        "value": .username
      }
    )
---
apiVersion: v1
kind: Secret
type: Opaque
metadata:
  name: jsonplaceholder-endpoint
  namespace: krateo-system
stringData:
  server-url: https://jsonplaceholder.typicode.com
---
# Dependencies field
# Target: validate fields whose available options depend on the value of another field
# Expected behavior: three fields are rendered, each field values depend on the previous field
# value being set, otherwise the field is disabled
kind: Form
apiVersion: widgets.templates.krateo.io/v1beta1
metadata:
  name: example-form-dependencies
  namespace: krateo-system
spec:
  widgetData:
    autocomplete:
      - name: regions
        resourceRefId: get-italian-regions
    dependencies:
      - name: provinces
        dependsOn:
          name: regions
        resourceRefId: get-italian-provinces
        extra:
          key: region_code
      - name: cities
        dependsOn:
          name: provinces
        resourceRefId: get-italian-cities
        extra:
          key: province_code
    submitActionId: submit-autocomplete
    stringSchema: |
      {
        "type": "object",
        "properties": {
          "regions": { "type": "string", "title": "Region" },
          "provinces": { "type": "string", "title": "Province" },
          "cities": { "type": "string", "title": "City" }
        },
        "required": ["regions", "provinces", "cities"]
      }
    actions:
      rest:
        - id: submit-autocomplete
          type: rest
          resourceRefId: resource-ref-1
          headers: []
  resourcesRefs:
    items:
      - id: resource-ref-1
        apiVersion: composition.krateo.io/v1
        name: submit-autocomplete
        namespace: krateo-system
        resource: fireworksapps
        verb: POST
      - id: get-italian-regions
        apiVersion: templates.krateo.io/v1
        name: get-italian-regions
        namespace: krateo-system
        resource: restactions
        verb: GET
      - id: get-italian-cities
        apiVersion: templates.krateo.io/v1
        name: get-italian-cities
        namespace: krateo-system
        resource: restactions
        verb: GET
      - id: get-italian-provinces
        apiVersion: templates.krateo.io/v1
        name: get-italian-provinces
        namespace: krateo-system
        resource: restactions
        verb: GET
---
apiVersion: templates.krateo.io/v1
kind: RESTAction
metadata:
  name: get-italian-regions
  namespace: krateo-system
spec:
  api:
  - name: regions
    path: "/api/explore/v2.1/catalog/datasets/georef-italy-regione/records"
    endpointRef:
      name: opendatasoft-endpoint
      namespace: krateo-system
  filter: >
    .regions.results | map({
      "label": .reg_name,
      "value": .reg_code
    })
---
apiVersion: templates.krateo.io/v1
kind: RESTAction
metadata:
  name: get-italian-provinces
  namespace: krateo-system
spec:
  api:
  - name: provinces
    path: ${ "/api/explore/v2.1/catalog/datasets/georef-italy-provincia/records?refine=reg_code:" + (.region_code) }
    endpointRef:
      name: opendatasoft-endpoint
      namespace: krateo-system
  filter: >
    .provinces.results | map({
      "label": .prov_name,
      "value": .prov_code
    })
---
apiVersion: templates.krateo.io/v1
kind: RESTAction
metadata:
  name: get-italian-cities
  namespace: krateo-system
spec:
  api:
  - name: cities
    path: ${ "/api/explore/v2.1/catalog/datasets/georef-italy-comune/records?refine=prov_code:" + (.province_code) }
    endpointRef:
      name: opendatasoft-endpoint
      namespace: krateo-system
  filter: >
    .cities.results | map({
      "label": .com_name,
      "value": .com_code
    })
---
apiVersion: v1
kind: Secret
type: Opaque
metadata:
  name: opendatasoft-endpoint
  namespace: krateo-system
stringData:
  server-url: https://public.opendatasoft.com
---
# Missing action
# Target: validate error handling when action is missing.
# Expected behavior: an error is displayed on submit to inform that the action is not defined.
kind: Form
apiVersion: widgets.templates.krateo.io/v1beta1
metadata:
  name: example-form-missing-action
  namespace: krateo-system
spec:
  widgetData:
    submitActionId: non-existent-action
    stringSchema: |
      {
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "title": "Application Name",
            "description": "The name of your app"
          }
        }
      }
    actions:
      rest:
        - id: submit-basic
          type: rest
          resourceRefId: resource-ref-1
          headers: []
  resourcesRefs:
    items:
      - id: resource-ref-1
        apiVersion: composition.krateo.io/v1
        name: submit-basic
        namespace: krateo-system
        resource: fireworksapps
        verb: POST
---
# Invalid action type
# Target: validate action type enforcement.
# Expected behavior: an error is displayed on submit to inform that the action type is not correct
kind: Form
apiVersion: widgets.templates.krateo.io/v1beta1
metadata:
  name: example-form-invalid-action
  namespace: krateo-system
spec:
  widgetData:
    submitActionId: open-modal-default
    stringSchema: |
      {
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "title": "Application Name",
            "description": "The name of your app"
          }
        }
      }
    actions:
      openModal:
        - id: open-modal-default
          type: openModal
          resourceRefId: example-yamlviewer-simple-json
          title: Default Modal Example
          loading:
            display: true
          size: default
  resourcesRefs:
    items:
      - id: example-yamlviewer-simple-json
        apiVersion: widgets.templates.krateo.io/v1beta1
        name: example-yamlviewer-simple-json
        namespace: krateo-system
        resource: yamlviewers
        verb: GET
---
# rest - Headers malformed (not a "key: value" structure)
# Target: one of the headers does not follow the expected textual format.
# Expected behavior: the header is ignored or causes server-side rejection depending on backend behavior; Form still tries to execute.
kind: Form
apiVersion: widgets.templates.krateo.io/v1beta1
metadata:
  name: example-form-rest-malformed-headers
  namespace: krateo-system
spec:
  widgetData:
    submitActionId: rest-bad-headers
    stringSchema: |
      {
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "title": "Application Name",
            "description": "The name of your app"
          }
        }
      }  
    actions:
      rest:
        - id: rest-bad-headers
          type: rest
          resourceRefId: create-pod
          headers:
            - "Authorization Bearer token"
            - "x-custom: valid"
  resourcesRefs:
    items:
      - id: create-pod
        apiVersion: v1
        resource: pods
        name: create-pod
        namespace: krateo-system
        verb: POST
---
# rest - No payload
# Target: action payload is empty and is not overridden by Form values.
# Expected behavior: payload is sent as-is; values are not modified or merged.
kind: Form
apiVersion: widgets.templates.krateo.io/v1beta1
metadata:
  name: example-form-rest-no-payload
  namespace: krateo-system
spec:
  widgetData:
    submitActionId: submit-basic
    stringSchema: |
      {
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "title": "Application Name",
            "description": "The name of your app"
          }
        }
      }  
    actions:
      rest:
        - id: submit-basic
          type: rest
          resourceRefId: create-configmap-from-form
          headers:
            - "Content-Type: application/json"
  resourcesRefs:
    items:
      - id: create-configmap-from-form
        apiVersion: v1
        resource: configmaps
        name: create-configmap-from-form
        namespace: krateo-system
        verb: POST
---
# rest - Static payload
# Target: action payload contains static values.
# Expected behavior: payload is sent as-is; values are not modified or merged.
kind: Form
apiVersion: widgets.templates.krateo.io/v1beta1
metadata:
  name: example-form-rest-static-payload
  namespace: krateo-system
spec:
  widgetData:
    submitActionId: submit-basic
    stringSchema: |
      {
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "title": "Application Name",
            "description": "The name of your app"
          }
        }
      }  
    actions:
      rest:
        - id: submit-basic
          type: rest
          resourceRefId: create-configmap-from-form
          payload:
           name: static-name
          headers:
            - "Content-Type: application/json"
  resourcesRefs:
    items:
      - id: create-configmap-from-form
        apiVersion: v1
        name: create-configmap-from-form
        resource: configmaps
        namespace: krateo-system
        verb: POST
---
# rest - Merged payload with resource payload
# Target: action payload is merged with the referenced resource payload.
# Expected behavior: resulting payload contains all fields from both action and resource; action payload values override resource payload in case of conflict.
kind: Form
apiVersion: widgets.templates.krateo.io/v1beta1
metadata:
  name: example-form-rest-merged-payload
  namespace: krateo-system
spec:
  widgetData:
    submitActionId: submit-basic
    stringSchema: |
      {
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "title": "Application Name",
            "description": "The name of your app"
          }
        }
      }  
    actions:
      rest:
        - id: submit-basic
          type: rest
          resourceRefId: create-configmap-from-form
          payload:
            metadata:
              name: static-name
          headers:
            - "Content-Type: application/json"
  resourcesRefs:
    items:
      - id: create-configmap-from-form
        apiVersion: v1
        name: different-name
        resource: configmaps
        namespace: krateo-system
        verb: POST
---
# rest - Payload overrides with static values
# Target: payloadToOverride specifies fields and static values to replace in the merged payload.
# Expected behavior: specified fields in payloadToOverride are correctly replaced
kind: Form
apiVersion: widgets.templates.krateo.io/v1beta1
metadata:
  name: example-form-rest-payload-override
  namespace: krateo-system
spec:
  widgetData:
    submitActionId: submit-basic
    stringSchema: |
      {
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "title": "Application Name",
            "description": "The name of your app"
          }
        }
      }  
    actions:
      rest:
        - id: submit-basic
          type: rest
          resourceRefId: create-configmap-from-form
          payload:
            metadata:
              name: static-name
          payloadToOverride:
            - name: metadata.name
              value: different-name
          headers:
            - "Content-Type: application/json"
  resourcesRefs:
    items:
      - id: create-configmap-from-form
        apiVersion: v1
        name: create-configmap-from-form
        resource: configmaps
        namespace: krateo-system
        verb: POST
---
# rest - Payload overrides with dynamic values from Form
# Target: payloadToOverride specifies fields and values to replace in the merged payload.
# Expected behavior: specified fields in payloadToOverride are correctly replaced by Form values.
kind: Form
apiVersion: widgets.templates.krateo.io/v1beta1
metadata:
  name: example-form-rest-payload-override-dynamic
  namespace: krateo-system
spec:
  widgetData:
    submitActionId: submit-basic
    stringSchema: |
      {
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "title": "Application Name",
            "description": "The name of your app"
          }
        }
      }  
    actions:
      rest:
        - id: submit-basic
          type: rest
          resourceRefId: create-configmap-from-form
          payload:
            metadata:
              name: static-name
          payloadToOverride:
            - name: metadata.name
              value: ${ .json.name }
          headers:
            - "Content-Type: application/json"
  resourcesRefs:
    items:
      - id: create-configmap-from-form
        apiVersion: v1
        name: create-configmap-from-form
        resource: configmaps
        namespace: krateo-system
        verb: POST
---
# rest - Customized success message
# Target: correct request -> successMessage is displayed
# Expected behavior: after the request succeeds a customized success message is displayed
kind: Form
apiVersion: widgets.templates.krateo.io/v1beta1
metadata:
  name: example-form-rest-success-message
  namespace: krateo-system
spec:
  widgetData:
    submitActionId: submit-basic
    stringSchema: |
      {
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "title": "Application Name",
            "description": "The name of your app"
          }
        }
      }  
    actions:
      rest:
        - id: submit-basic
          type: rest
          successMessage: 'This is a customized message: successful request!'
          resourceRefId: create-configmap-from-form
          payload:
            metadata:
              name: static-name
          headers:
            - "Content-Type: application/json"
  resourcesRefs:
    items:
      - id: create-configmap-from-form
        apiVersion: v1
        name: config-map-success-message
        resource: configmaps
        namespace: krateo-system
        verb: POST
---
# rest - Customized success message with JQ expression
# Target: correct request -> successMessage with JQ expression is displayed
# Expected behavior: after the request succeeds a customized success message is displayed
# The message interpolates a variable using JQ
kind: Form
apiVersion: widgets.templates.krateo.io/v1beta1
metadata:
  name: example-form-rest-success-message-jq
  namespace: krateo-system
spec:
  widgetData:
    submitActionId: submit-basic
    stringSchema: |
      {
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "title": "Application Name",
            "description": "The name of your app"
          }
        }
      }  
    actions:
      rest:
        - id: submit-basic
          type: rest
          successMessage: '${ "Success after inserting name: " + .json.metadata.name }'
          resourceRefId: create-configmap-from-form
          payload:
            metadata:
              name: static-name
          headers:
            - "Content-Type: application/json"
  resourcesRefs:
    items:
      - id: create-configmap-from-form
        apiVersion: v1
        name: config-map-success-message-jq
        resource: configmaps
        namespace: krateo-system
        verb: POST
---
### rest - Customized error message
# Target: malformed request -> errorMessage is displayed
# Expected behavior: after the request fails a customized error message is displayed
kind: Form
apiVersion: widgets.templates.krateo.io/v1beta1
metadata:
  name: example-form-rest-error-message
  namespace: krateo-system
spec:
  widgetData:
    submitActionId: submit-basic
    stringSchema: |
      {
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "title": "Application Name",
            "description": "The name of your app"
          }
        }
      }  
    actions:
      rest:
        - id: submit-basic
          type: rest
          errorMessage: 'This is a customized message: resource already existing'
          resourceRefId: create-configmap-from-form
          payload:
            metadata:
              name: static-name
          headers:
            - "Content-Type: application/json"
  resourcesRefs:
    items:
      - id: create-configmap-from-form
        apiVersion: v1
        name: snowplow
        resource: configmaps
        namespace: krateo-system
        verb: POST
---
### rest - Customized error message with JQ expression
# Target: malformed request -> errorMessage with JQ expression is displayed
# Expected behavior: after the request fails a customized error message is displayed
# The message interpolates a variable using JQ
kind: Form
apiVersion: widgets.templates.krateo.io/v1beta1
metadata:
  name: example-form-rest-error-message-jq
  namespace: krateo-system
spec:
  widgetData:
    submitActionId: submit-basic
    stringSchema: |
      {
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "title": "Application Name",
            "description": "The name of your app"
          }
        }
      }  
    actions:
      rest:
        - id: submit-basic
          type: rest
          errorMessage: '${"Error while executing action on resource: " + .response.message }'
          resourceRefId: create-configmap-from-form
          payload:
            metadata:
              name: static-name
          headers:
            - "Content-Type: application/json"
  resourcesRefs:
    items:
      - id: create-configmap-from-form
        apiVersion: v1
        name: snowplow
        resource: configmaps
        namespace: krateo-system
        verb: POST
---
### rest - Navigation on success
### Target: correct request -> redirect to another page (onSuccessNavigateTo)
### Expected behaviour: after the request is successfully executed, there is a redirect to a specified page
kind: Form
apiVersion: widgets.templates.krateo.io/v1beta1
metadata:
  name: example-form-rest-navigate-success
  namespace: krateo-system
spec:
  widgetData:
    submitActionId: submit-basic
    stringSchema: |
      {
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "title": "Application Name",
            "description": "The name of your app"
          }
        }
      }  
    actions:
      rest:
        - id: submit-basic
          type: rest
          resourceRefId: create-configmap-from-form
          onSuccessNavigateTo: /barchart
          payload:
            metadata:
              name: static-name
          headers:
            - "Content-Type: application/json"
  resourcesRefs:
    items:
      - id: create-configmap-from-form
        apiVersion: v1
        name: create-configmap-from-form-navigate-success
        resource: configmaps
        namespace: krateo-system
        verb: POST
---
### rest - Navigation on success with dynamic URL via JQ expression
### Target: correct request -> redirect to another page (onSuccessNavigateTo) -> URL is specified by JQ expression
### Expected behaviour: after the request is successfully executed, there is a redirect to a specified page
### The URL is fetched by interpolating a JQ expression.
### In this case we expect 404 since we are redirecting to a non existent page.
kind: Form
apiVersion: widgets.templates.krateo.io/v1beta1
metadata:
  name: example-form-rest-navigate-success-jq
  namespace: krateo-system
spec:
  widgetData:
    submitActionId: submit-basic
    stringSchema: |
      {
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "title": "Application Name",
            "description": "The name of your app"
          }
        }
      }  
    actions:
      rest:
        - id: submit-basic
          type: rest
          resourceRefId: create-configmap-from-form
          onSuccessNavigateTo: ${ .json.metadata.name }
          payload:
            metadata:
              name: static-name
          headers:
            - "Content-Type: application/json"
  resourcesRefs:
    items:
      - id: create-configmap-from-form
        apiVersion: v1
        name: create-configmap-from-form-navigate-success-jq
        resource: configmaps
        namespace: krateo-system
        verb: POST
---
### rest - Navigation on event received (fail)
### Target: correct request -> loading message -> error after timeout
### Expected behaviour: after the request is successfully executed, a loading message is displayed
### Timeout occurs since the specific event will not arrive.
kind: Form
apiVersion: widgets.templates.krateo.io/v1beta1
metadata:
  name: example-form-rest-event-navigation-fail
  namespace: krateo-system
spec:
  widgetData:
    submitActionId: submit-basic
    stringSchema: |
      {
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "title": "Application Name",
            "description": "The name of your app"
          }
        }
      }  
    actions:
      rest:
        - id: submit-basic
          type: rest
          resourceRefId: create-configmap-from-form
          onEventNavigateTo:
            eventReason: NotExistentEvent
            url: "/barchart"
            timeout: 30
            loadingMessage: "Waiting for the update event to fail..."
          payload:
            metadata:
              name: static-name
          headers:
            - "Content-Type: application/json"
  resourcesRefs:
    items:
      - id: create-configmap-from-form
        apiVersion: v1
        name: create-configmap-from-form-navigate-event-fail
        resource: configmaps
        namespace: krateo-system
        verb: POST
---
### rest - Navigation on event received (success)
### Target: correct request -> redirect to another page after (onEventNavigateTo)
### Expected behaviour: after the request is successfully executed, there is a redirect to a specified page
### Navigation is executed once a specified event is received.
kind: Form
apiVersion: widgets.templates.krateo.io/v1beta1
metadata:
  name: example-form-rest-event-navigation-success
  namespace: krateo-system
spec:
  widgetData:
    submitActionId: create-pod
    stringSchema: |
      {
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "title": "Application Name",
            "description": "The name of your app"
          }
        }
      }  
    actions:
      rest:
        - id: create-pod
          type: rest
          resourceRefId: create-pod
          onEventNavigateTo:
            eventReason: Started
            url: "/barchart"
            timeout: 30
            loadingMessage: "Waiting for the update event..."
          payload:
            apiVersion: v1
            kind: Pod
            metadata:
              name: event-demo-pod
              labels:
                app: event-demo
            spec:
              containers:
                - name: demo
                  image: nginx:latest
          headers:
            - "Content-Type: application/json"
  resourcesRefs:
    items:
      - id: create-pod
        apiVersion: v1
        resource: pods
        name: event-demo-pod
        namespace: krateo-system
        verb: POST